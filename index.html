<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor-Patient Speech-to-Text</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            background-image: url('download.jpg');
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 20px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        .start-btn {
            background-color: #28a745;
            color: white;
        }
        .stop-btn {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Doctor-Patient Dialogue</h1>
        <textarea id="patientText" placeholder="Patient's speech will appear here..." readonly></textarea>
        <textarea id="doctorText" placeholder="Doctor's speech will appear here..." readonly></textarea>
        <div>
            <button id="startBtn" class="start-btn">Start Conversation</button>
            <button id="stopBtn" class="stop-btn" disabled>Stop Conversation</button>
        </div>
    </div>

    <script>
        let recognition; // Speech recognition object
        let isRecording = false;
        let activeSpeaker = "patient"; // Default to patient
        let timeoutId;

        // Initialize Speech Recognition
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
        } else {
            alert("Speech recognition not supported in this browser. Try using Chrome.");
        }

        recognition.continuous = true; // Keep listening
        recognition.lang = 'en-US'; // Set language
        recognition.interimResults = false;

        // Start Button
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const patientText = document.getElementById('patientText');
        const doctorText = document.getElementById('doctorText');

        // Start Recognition
        startBtn.addEventListener('click', () => {
            if (!isRecording) {
                isRecording = true;
                recognition.start();
                startBtn.disabled = true;
                stopBtn.disabled = false;

                // Automatically stop after 20 minutes
                timeoutId = setTimeout(() => {
                    stopConversation();
                }, 20 * 60 * 1000); // 20 minutes

                alert("Recording started. Patient speaks first.");
            }
        });

        // Stop Recognition
        stopBtn.addEventListener('click', stopConversation);

        function stopConversation() {
            if (isRecording) {
                isRecording = false;
                recognition.stop();
                startBtn.disabled = false;
                stopBtn.disabled = true;

                clearTimeout(timeoutId);
                alert("Recording stopped.");
            }
        }

        // Handle Speech Recognition Results
        recognition.onresult = (event) => {
            const transcript = event.results[event.results.length - 1][0].transcript.trim();

            if (activeSpeaker === "patient") {
                patientText.value += transcript + "\n";
                activeSpeaker = "doctor"; // Switch to doctor
                alert("Now the doctor can speak.");
            } else {
                doctorText.value += transcript + "\n";
                activeSpeaker = "patient"; // Switch to patient
                alert("Now the patient can speak.");
            }
        };

        // Handle Errors
        recognition.onerror = (event) => {
            console.error("Speech recognition error:", event.error);
            alert("An error occurred: " + event.error);
            stopConversation();
        };
    </script>
</body>
</html>
